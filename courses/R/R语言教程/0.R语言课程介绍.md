## 一、实验说明 

### 1. 环境登录 

无需密码自动登录，系统用户名shiyanlou 

### 2. 环境介绍 

本实验环境采用Ubuntu Linux桌面环境，实验中会用到桌面上的程序： 

1.命令行终端: Linux命令行终端，打开后会进入Bash环境，可以使用Linux命令 

2.Firefox及Opera：浏览器，可以用在需要前端界面的课程里，只需要打开环境里写的HTML/JS页面即可 

3.gvim：非常好用的Vim编辑器，最简单的用法可以参考课程[Vim编辑器](http://www.shiyanlou.com/courses/2) 

4.gedit及Brackets：如果您对gvim的使用不熟悉，可以用这两个作为代码编辑器，其中Brackets非常适用于前端代码开发 

### 3. 环境使用 

使用编辑器输入实验所需的代码及文件，使用命令行终端运行所需命令进行操作。 


“实验记录”页面可以在“我的主页”中查看，每次实验的截图及笔记，以及有效学习时间（指的是在实验桌面内操作的时间，如果没有操作，系统会记录为发呆时间）。这些都是您在实验楼学习的真实性证明。 

###4. 参考文档

本实验课程基于张丹的R语言系列博客制作：

+ http://blog.fens.me/series-r/

推荐阅读作者的R语言著作：

+ [《R的极客理想-工具篇》](http://blog.fens.me/r-book1/)

##二、 R的语言介绍

R语言是一门统计语言，主要用于数学建模、统计计算、数据处理、可视化等几个方向，R语言天生就不同于其他的编程语言。R语言封装了各种基础学科的计算函数，我们在R语言编程的过程中只需要调用这些计算函数，就可以构建出面向不同领域、不同业务的、复杂的数学模型。掌握R语言的语法，仅仅是学习R语言的第一步，要学好R语言，需要你具备基础学科能力(初等数学，高等数学，线性代数，离散数学，概率论，统计学)+业务知识(金融，生物，互联网)+IT技术(R语法，R包，数据库，算法)。所以把眼光放长点，只有把自己的综合知识水平提升，你才能真正地学好R语言。换句话说，一旦你学成了R语言，你将是不可被替代的。

###1. R的知识体系结构概览

R的知识体系结构是复杂的，要想学好R，就必须把多学科的知识综合运用，所以最大的难点不在于语言本身，而在于使用者的知识基础和综合运用的能力。

首先，从宏观上让我们先看一下R的知识体系结构的全貌，然后再分别解释每个部分的细节。

![Alt text](https://dn-anything-about-doc.qbox.me/md0417153rbase.png)

注：此图仅仅是我对R语言的理解，不排除由于个人阅历有限，观点片面的问题。

图中我将R语言知识体系结构分为3个部分：IT技术 + 业务知识 + 基础学科。

+ IT技术：是计算机时代必备的技术之一，R语言就是一种我们应该要掌握的技术。
+ 业务知识：是市场经验和法则，不管你在什么公司，都会有自己的产品、销售、市场等，你要了解你的公司产品有什么，客户是谁，怎么才能把产品卖给你的客户。
+ 基础学科：是我们这十几年在学校学的理论知识，当初学的时候并不知道是为了什么，毕业后如果你还能掌握一些知识并实际运用，那么这将是你最有价值的竞争力。

每个部分知识单独看都有其局限性，但如果能把知识两两结合起来，就构成了我们现在社会的各种技术创新点。

+ IT技术+业务知识：创造了阿里巴巴的电子商务帝国，腾讯全生态链的社交网络。
+ IT技术+基础学科：创造了Google搜索的神话，华尔街金融不败的帝国。当然，R语言只是一门计算机语言技术，不能独自承担改写历史的重任，但R语言实给了我们很大的想像空间，让我们能动手去了解这个世界的规律，找到无穷无尽的交叉点，创造出新的帝国。

如果你和我一样，都能站在这个角度来学习和使用R语言，那么我们一定可以成为并肩向前的同路人。我们正在努力改变着未来。

### 2. R语言基础的知识

蓝图总是宏大和美好的，具体落实也将是困难重重的。希望大家持之以恒坚持学习！

R语言基础的知识，包括R语言的语法，R语言核心包的使用，R语言的内核编程，R语言包的开发，以及R语言的虚拟机。

#### 2.1 R语言的语法

语法是我们了解R语言的第一步，和所有人一样，我也在很短的时间就适应R的语法规则，数据结构，基本类型，常用函数等等。但其实R的语法上的坑远比你知道的多得多。

我举个例子，看谁能准确的回答。比如，最基础的符号操作"=","<-","<<-" ，三者有什么区别，分别在什么时候用？不要偷偷说问题太偏了，实际根本用不到。我的代码里处处都在用这3个符号，只是你不知道而已。在学习R的时候，不要用已经掌握的C,Java,Python的经验直接去套R的语法，掉坑里的就是这些人。要重头开始学，一路上没有捷径。

R语言是函数式语言，语法自由，命名自由，使用简单，这只是对于普通用户来说的。作为一个有理想的极客，怎么能只停留在语法上呢！R是完全面向对象的，你了解什么是面向对象吗？R的面向对象打破了R原有的自由，但又要兼容原有的自由语法，多么纠结的设计啊，你能体会到吗？并不是记住了R的语法，就代表掌握了R语言。里面各种坑，只有自己踩了，再自己爬出来，才是真正的成长。

#### 2.2 R语言核心包的使用

R语言同其他语言一样，在软件启动时，为我们提供了7个核心包，包括了众多的基础函数，如数学计算函数，统计计算函数，日期函数，包加载函数，数据处理函数，函数操作函数，图形设备函数等。通过search()函数，可以查看到R启动时默认加载7个核心包。

**注：在终端中输入R即可进入R语言编程环境，输入q()退出环境。**

```
> search()
[1] ".GlobalEnv"        "package:stats"     "package:graphics"
[4] "package:grDevices" "package:utils"     "package:datasets"
[7] "package:methods"   "Autoloads"         "package:base"
```

这7个核心包，就是我们构建复杂模型的基础。由于这几个核心包比较底层，很多函数都是用C语言封装的没有R的源代码，而且除了官方文档，几乎没有其他更详细的文档介绍，所以这几个核心包就是学习的门槛，不要觉得某些函数会用了就行了，背后还有更深一层意义。

再问个问题，R的所有操作都是函数操作，那么“a<-1:10”语句会被解析对应什么函数？


```
> a<-1:10;a
 [1]  1  2  3  4  5  6  7  8  9 10
```

答案是，"1:10"对应"seq(1:10)"，"<-"对应assign()。


```
> assign('b',seq(1:10));b
 [1]  1  2  3  4  5  6  7  8  9 10
```

掌握这种对应关系的意义在于，因为R是解释型语言，我们可以通过传递一个函数A的句柄，让其他的函数B动态调用这个函数A，这就是动态语言中的闭包特性的使用思路。在JavaScript中，已经被广泛使用了，但在R语言中，却只有核心包的一些函数在使用这种语法。在R语言中，这种需要有计算机背景知识的地方还有很多，特别是在考虑如何提升R性能的部分。所以，不要太轻易就说自己掌握了R语言，多想想如何才能把其他语言的基础带到R语言的世界里。

####2.3 R语言的内核编程

R语言的内核编程，又是一个比较复杂的计算机学科的问题。R的内核编程应该包括哪些内容呢，除了刚才说的R的语法和R的核心包，还有面向对象编程，量向化计算，特殊数据类型，环境空间等。

面向对象编程，是一种对现实世界理解和抽象的方法，主要用于解决复杂问题的设计及实现。在Java的世界里，从2003年开始我接触Java的时候，社区就已经在聊面向对象的程序设计了。对于R语言来说，直到2010年发布的2.12版本，才最终有了RC类型的面向对象实现。面向对象的成熟，标志着R已经具备了构建复杂大型应用的能力，但如何真正地把面向对象用好，似乎也并不是统计人擅长的。有能力写出像HadleyWickham面向对象代码的人，在R的圈子里，实在是极少数的。

量向化计算，是R语言特有的一种并行计算方式。在R中，向量是R的基本数据类型(vector)，当你对一个向量进行操作时，程序会对向量中每个元素进行分别计算，计算结果以向量的形式返回。比如，最常见的两个等长的向量相加。

```
> 1:10+10:1
 [1] 11 11 11 11 11 11 11 11 11 11
```

向量化计算，在R中有很广泛的应用场景，基本可以取代循环计算，高效的完成计算任务。我们定义两个向量，先相加再求和，run1()函数用向量化计算实现，run2()用循环方法实现。


```
> a<-1:100000
> b<-100000:1

> run1<-function(){  # 向量化计算
+   sum(as.numeric(a+b))
+ }
 
> run2<-function(){  # 循环计算
+   c2<-0
+   for(i in 1:length(a)){
+     c2<-a[i]+b[i]+c2
+   }
+   c2
+ }

> system.time(run1())
用户  系统  流逝
0.000 0.000 0.001 

> system.time(run2())
用户  系统  流逝
0.190 0.002 0.396
```

通过运行程序，我们可以清楚地看出，向量化计算要比循环快(上述时间根据机器的不同可能会有所不同)。当算法越复杂数据量越大的时候，计算的时间差距会越明显的。R的编程中的一条法则就是用向量计算代替所有的循环计算。

特殊数据类型，R语言中除了那些基本的数据类型，还有一些高级的数据类型，并不是不常用，而是你不知道。

S3类型，S4类型，RC类型分别对应R语言支持的三种面向对象编程的数据结构。

环境类型(environment)，由内核定义的一个数据结构，由一系列的、有层次关系的框架(frame)组成，每个环境对应一个框架，用来区别不同的运行时空间(scope)。

环境空间，在进行R包开发时，是必备的一个知识点。每个环境空间都是环境类型的一个实例。每个R包都会被加载到一个环境空间中，形成有层次关系的、可调用的空间结构。

我们定义的函数和变量，都会存在于R的环境空间中，通过ls()就可以看到当前环境空间中的这些变量，比如，刚才量向化计算定义的变量和函数。


```
> ls()
[1] "a"    "b"    "run1" "run2"
```

除了我们自己定义的变量和函数，环境空间中还有很多其他的变量和函数，比如sum(), length(),system.time()等，这些函数我们可以直接使用，但是它们并不在当前环境空间中，所以直接用ls()是查看不到的。当我们切换到base的环境空间时，就可以找到sum()的函数定义了。


```
> ls(pattern="^sum$",envir=baseenv())
[1] "sum"
```

R语言内核编程，如同其他语言一样，有很多的知识细节，并不是只有我提到的这几点。但由于缺少文档，同时R核心技术的不普及，所以知道的人就不多，会用的人更少。我也在每天探索，期待发现更多的秘密。

## 三、小结

R语言是一门统计语言，主要用于数学建模、统计计算、数据处理、可视化等几个方向，R语言天生就不同于其他的编程语言，要学好R语言，需要你具备基础学科能力(初等数学，高等数学，线性代数，离散数学，概率论，统计学)+业务知识(金融，生物，互联网)+IT技术(R语法，R包，数据库，算法)。

## 四、练习

请深入了解R语言可以应用在哪些方面。

实验中有任何问题欢迎到[实验楼问答](http://www.shiyanlou.com/questions)提问。